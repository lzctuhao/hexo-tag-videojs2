/*! @name videojs-playlist-ui @version 4.1.0 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).videojsPlaylistUi=e(t.videojs)}(this,function(t){"use strict";var e=function(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}(t);const s=e.default.dom||e.default,i=e.default.registerPlugin||e.default.plugin,l={className:"vjs-playlist",playOnSelect:!1,supportsCssPointerEvents:(()=>{const t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents})()},n=function(t){t.addClass("vjs-selected")},a=function(t){t.removeClass("vjs-selected"),t.thumbnail&&s.removeClass(t.thumbnail,"vjs-playlist-now-playing")},o=function(t){t.addClass("vjs-up-next")},d=function(t){t.removeClass("vjs-up-next")},r=function(t){if(!t){const t=document.createElement("div");return t.className="vjs-playlist-thumbnail vjs-playlist-thumbnail-placeholder",t}const e=document.createElement("picture");if(e.className="vjs-playlist-thumbnail","string"==typeof t){const s=document.createElement("img");s.loading="lazy",s.src=t,s.alt="",e.appendChild(s)}else{for(let s=0;s<t.length-1;s++){const i=t[s],l=document.createElement("source");for(const t in i)l[t]=i[t];e.appendChild(l)}const s=t[t.length-1],i=document.createElement("img");i.loading="lazy",i.alt="";for(const t in s)i[t]=s[t];e.appendChild(i)}return e},p=e.default.getComponent("Component");class c extends p{constructor(t,e,s){if(!e.item)throw new Error("Cannot construct a PlaylistMenuItem without an item option");e.showDescription=s.showDescription,super(t,e),this.item=e.item,this.playOnSelect=s.playOnSelect,this.emitTapEvents(),this.on(["click","tap"],this.switchPlaylistItem_),this.on("keydown",this.handleKeyDown_)}handleKeyDown_(t){13!==t.which&&32!==t.which||this.switchPlaylistItem_()}switchPlaylistItem_(t){this.player_.playlist.currentItem(this.player_.playlist().indexOf(this.item)),this.playOnSelect&&this.player_.play()}createEl(){const t=document.createElement("li"),s=this.options_.item,i=this.options_.showDescription;if("object"==typeof s.data){Object.keys(s.data).forEach(e=>{const i=s.data[e];t.dataset[e]=i})}if(t.className="vjs-playlist-item",t.setAttribute("tabIndex",0),this.thumbnail=r(s.thumbnail),t.appendChild(this.thumbnail),s.duration){const i=document.createElement("time"),l=e.default.formatTime(s.duration);i.className="vjs-playlist-duration",i.setAttribute("datetime","PT0H0M"+s.duration+"S"),i.appendChild(document.createTextNode(l)),t.appendChild(i)}const l=document.createElement("span"),n=this.localize("Now Playing");l.className="vjs-playlist-now-playing-text",l.appendChild(document.createTextNode(n)),l.setAttribute("title",n),this.thumbnail.appendChild(l);const a=document.createElement("div");a.className="vjs-playlist-title-container",this.thumbnail.appendChild(a);const o=document.createElement("span"),d=this.localize("Up Next");o.className="vjs-up-next-text",o.appendChild(document.createTextNode(d)),o.setAttribute("title",d),a.appendChild(o);const p=document.createElement("cite"),c=s.name||this.localize("Untitled Video");if(p.className="vjs-playlist-name",p.appendChild(document.createTextNode(c)),p.setAttribute("title",c),a.appendChild(p),i){const t=document.createElement("div"),e=s.description||"";t.className="vjs-playlist-description",t.appendChild(document.createTextNode(e)),t.setAttribute("title",e),a.appendChild(t)}return t}}class h extends p{constructor(t,s){if(!t.playlist)throw new Error("videojs-playlist is required for the playlist component");super(t,s),this.items=[],s.horizontal?this.addClass("vjs-playlist-horizontal"):this.addClass("vjs-playlist-vertical"),s.supportsCssPointerEvents&&this.addClass("vjs-csspointerevents"),this.createPlaylist_(),e.default.browser.TOUCH_ENABLED||this.addClass("vjs-mouse"),this.on(t,["loadstart","playlistchange","playlistsorted"],t=>{this.update()}),this.on(t,"adstart",()=>{this.addClass("vjs-ad-playing")}),this.on(t,"adend",()=>{this.removeClass("vjs-ad-playing")}),this.on("dispose",()=>{this.empty_(),t.playlistMenu=null}),this.on(t,"dispose",()=>{this.dispose()})}createEl(){return s.createEl("div",{className:this.options_.className})}empty_(){this.items&&this.items.length&&(this.items.forEach(t=>t.dispose()),this.items.length=0)}createPlaylist_(){const t=this.player_.playlist()||[];let e=this.el_.querySelector(".vjs-playlist-item-list"),i=this.el_.querySelector(".vjs-playlist-ad-overlay");e||((e=document.createElement("ol")).className="vjs-playlist-item-list",this.el_.appendChild(e)),this.empty_();let l=document.createElement("li");l.className="vjs-playlist-item-listtip",l.innerText="播放列表",e.appendChild(l);for(let s=0;s<t.length;s++){const i=new c(this.player_,{item:t[s]},this.options_);this.items.push(i),e.appendChild(i.el_)}i?e.appendChild(i):((i=document.createElement("li")).className="vjs-playlist-ad-overlay",e.appendChild(i));const a=this.player_.playlist.currentItem();if(this.items.length&&a>=0){n(this.items[a]);const t=this.items[a].$(".vjs-playlist-thumbnail");t&&s.addClass(t,"vjs-playlist-now-playing")}}update(){const t=this.player_.playlist();if(this.items.length!==t.length)return void this.createPlaylist_();for(let e=0;e<this.items.length;e++)if(this.items[e].item!==t[e])return void this.createPlaylist_();const e=this.player_.playlist.currentItem();for(let t=0;t<this.items.length;t++){const i=this.items[t];if(t===e){n(i);let e=this.items[t].options_.item.description,l=this.player_.el_.parentNode.nextSibling.nextSibling;l.innerHTML=e||"",document.activeElement!==i.el()&&s.addClass(i.thumbnail,"vjs-playlist-now-playing"),d(i)}else t===e+1?(a(i),o(i)):(a(i),d(i))}}}const m=t=>{for(let e=0;e<t.childNodes.length;e++)if(s.isEl(t.childNodes[e]))return!0;return!1},u=function(t){const i=this;if(!i.playlist)throw new Error("videojs-playlist plugin is required by the videojs-playlist-ui plugin");s.isEl(t)&&(e.default.log.warn('videojs-playlist-ui: Passing an element directly to playlistUi() is deprecated, use the "el" option instead!'),t={el:t}),t=e.default.mergeOptions(l,t);let n=this.player_.el_;if(document.addEventListener("load",function(){n.parentNode.nextElementSibling.style.maxHeight=n.clientHeight+"px",n=null}),i.playlistMenu){const e=i.playlistMenu.el();if(e){const l=e.parentNode,n=e.nextSibling;i.playlistMenu.dispose(),s.emptyEl(e),n?l.insertBefore(e,n):l.appendChild(e),t.el=e}}s.isEl(t.el)||(t.el=(t=>{const e=document.querySelectorAll("."+t);let s;for(let t=0;t<e.length;t++)if(!m(e[t])){s=e[t];break}return s})(t.className)),i.playlistMenu=new h(i,t)};return e.default.registerComponent("PlaylistMenu",h),e.default.registerComponent("PlaylistMenuItem",c),i("playlistUi",u),u.VERSION="4.1.0",u});